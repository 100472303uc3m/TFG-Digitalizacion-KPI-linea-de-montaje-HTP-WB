<!DOCTYPE html>
<html>
  <head>
    <base target="_top">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Style for loading spinner -->
    <style>
      #spinnerOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255,255,255,0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <!-- Loading Spinner Overlay -->
    <div id="spinnerOverlay">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <!-- Content -->
    <div class="container mt-3">
      <form id="linkForm">
        <div class="row mb-3">
          <label class="col-sm-2 col-form-label">Enlace 1</label>
          <div class="col-sm-10"><input type="text" class="form-control" id="link0"></div>
        </div>
        <div class="row mb-3">
          <label class="col-sm-2 col-form-label">Enlace 2</label>
          <div class="col-sm-10"><input type="text" class="form-control" id="link1"></div>
        </div>
        <div class="row mb-3">
          <label class="col-sm-2 col-form-label">Enlace 3</label>
          <div class="col-sm-10"><input type="text" class="form-control" id="link2"></div>
        </div>
        <div class="row mb-3">
          <label class="col-sm-2 col-form-label">Enlace 4</label>
          <div class="col-sm-10"><input type="text" class="form-control" id="link3"></div>
        </div>
        <div class="d-flex justify-content-end align-items-center">
          <button type="button" id="cancelBtn" class="btn btn-secondary me-2" onclick="closeDialog()">Cancelar</button>
          <button type="button" id="saveBtn" class="btn btn-primary d-flex align-items-center" onclick="submitLinks()">
            <span id="saveSpinner" class="spinner-border spinner-border-sm me-2" role="status" style="display:none;"></span>
            Guardar
          </button>
        </div>
      </form>
    </div>

    <script>
      // Constants
      const spinnerOverlay = document.getElementById('spinnerOverlay');
      const form = document.getElementById('linkForm');
      const inputs = Array.from(form.querySelectorAll('input'));
      const saveBtn = document.getElementById('saveBtn');
      const cancelBtn = document.getElementById('cancelBtn');
      const saveSpinner = document.getElementById('saveSpinner');

      // Show links in inputs and hide loading spinner
      function showLinks(links) {
        for (let i = 0; i < 4; i++) {
          const input = document.getElementById('link' + i);
          if (input) input.value = (links && links[i] && links[i][0]) ? links[i][0] : '';
        }
        spinnerOverlay.style.display = 'none';
      }

      // Disable form and show spinner on save
      function disableForm() {
        inputs.forEach(input => input.disabled = true);
        saveBtn.disabled = true;
        cancelBtn.disabled = true;
        saveSpinner.style.display = 'inline-block';
      }

      // Submit links to server
      function submitLinks() {
        disableForm();
        const newLinks = inputs.map(input => [input.value || '']);
        google.script.run.withSuccessHandler(closeDialog).editLinks(newLinks);
      }

      // Close dialog
      function closeDialog() {
        google.script.host.close();
      }

      // Retrieve links from link sheet when ready
      document.addEventListener('DOMContentLoaded', () => {
        google.script.run.withSuccessHandler(showLinks).readLinks();
      });
    </script>
  </body>
</html>
